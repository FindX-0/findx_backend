datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator kysely {
  provider     = "prisma-kysely"
  output       = "../src/entities"
  fileName     = "entityTypes.ts"
  enumFileName = "entityEnums.ts"
}

enum Gender {
  MALE
  FEMALE
  OTHER

  @@map("gender")
}

enum AuthProvider {
  EMAIL
  GOOGLE
  APPLE
  FACEBOOK

  @@map("authProvider")
}

model User {
  id           BigInt       @id @default(autoincrement())
  email        String       @unique @db.VarChar(255)
  userName     String?      @db.VarChar(255)
  gender       Gender?
  passwordHash String       @db.VarChar(255)
  createdAt    DateTime     @default(now())
  isCompleted  Boolean      @default(true)
  authProvider AuthProvider @default(EMAIL)

  refreshTokens       RefreshToken[]
  accountVerification AccountVerification?

  @@index([email])
  @@map("users")
}

model RefreshToken {
  id        BigInt   @id @default(autoincrement())
  userId    BigInt
  value     String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([value], type: Hash)
  @@map("refreshTokens")
}

model AccountVerification {
  id          BigInt   @id @default(autoincrement())
  isVerified  Boolean  @default(false)
  oneTimeCode Int
  userId      BigInt   @unique
  createdAt   DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@map("accountVerification")
}
